<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>tp1</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
       <style>
        body {
            font-family: Arial, sans-serif;
            background: #f7f7f7;
            margin: 0;
            padding: 0;
        }
        #app {
            max-width: 500px;
            margin: 40px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px 32px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin-bottom: 8px;
        }
        input[type="text"] {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
            width: 70%;
            margin-right: 8px;
        }
        button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: #fff;
            cursor: pointer;
            margin-right: 4px;
        }
        button:hover {
            background: #2980b9;
        }
        input[type="checkbox"] {
            margin-right: 8px;
        }
        p {
            font-size: 1rem;
            margin: 12px 0 0 0;
        }
    </style>

</head>
<body>
  <div id="app">
    <h1>{{ mensaje }}</h1>
    <ul>
      <li>Nombre: {{ nombre }}</li>
      <li>Edad: {{ edad }}</li>
      <li>Ciudad: {{ ciudad }}</li>
      <li>Hola, mi nombre es {{ nombre }}, tengo {{ edad }} años y vivo en {{ ciudad }}.</li>
    </ul><br>

    <button @click="incrementar">Incrementar</button>
    <button @click="decrementar">Decrementar</button>
    <p>Contador: {{ contador }}</p><br>

    <input v-model="nuevaTarea" placeholder="Nueva tarea">
    <button @click="agregarTarea">Agregar tarea</button>

    <ul>
      <li v-for="tarea in tareas" :key="tarea.id">
        <input type="checkbox" v-model="tarea.completa" @change="guardarTareas">
        {{ tarea.texto }}
      </li>
    </ul>

    <p>Tareas pendientes: {{ tareasPendientes }}</p>
    <p>Total tareas: {{ totalTareas }}</p>

    <h2>Eventos registrados</h2>
    <ul>
      <li v-for="evento in listaeventos" :key="evento.id">
        ID {{ evento.id }} - {{ evento.nombre }} - {{ evento.timestamp }}
      </li>
    </ul>
  </div>

  <script>
    // Variable Externa para eventos antes de que Vue exista.
    const eventosTemporales = [];

    // Función para registrar eventos fuera de Vue
    function registrarEventoGlobal(nombreEvento) {
      const ahora = new Date();
      const timestamp = ahora.toLocaleString('es-AR', {
        hour12: false,
        timeZone: 'America/Argentina/Buenos_Aires',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      }) + '.' + ahora.getMilliseconds();

      eventosTemporales.push({
        id: eventosTemporales.length + 1,
        nombre: nombreEvento,
        timestamp: timestamp
      });
    }

    // Registro de evento antes de crear Vue
    registrarEventoGlobal('beforeCreate');

    const { createApp } = Vue;

    createApp({
      data() {
        return {
          contadorID: eventosTemporales.length + 1,
          mensaje: 'Parcial2 PWA',
          nombre: 'Ana Garcia',
          edad: '30',
          ciudad: 'Tupungato',
          contador: 0,
          nuevaTarea: '',
          listaeventos: [],
          tareas: [
            { id: 1, texto: 'Estudiar Vue', completa: false },
          ]
        };
      },

      methods: {
        registrarEvento(nombreEvento) {
          const ahora = new Date();
          const timestamp = ahora.toLocaleString('es-AR', {
            hour12: false,
            timeZone: 'America/Argentina/Buenos_Aires',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          }) + '.' + ahora.getMilliseconds();

          this.listaeventos.push({
            id: this.contadorID++,
            nombre: nombreEvento,
            timestamp: timestamp
            
          });

          
        },

        incrementar() {
          this.contador++;
          this.registrarEvento('Incrementar');
        },
        decrementar() {
          this.contador--;
          this.registrarEvento('Decrementar');
        },
        agregarTarea() {
          if (this.nuevaTarea.trim() !== '') {
            const nuevoId = Date.now();
            this.tareas.push({
              id: nuevoId,
              texto: this.nuevaTarea,
              completa: false
            });
            this.nuevaTarea = '';
            localStorage.setItem('tareas', JSON.stringify(this.tareas));
            this.registrarEvento('Agregar Tarea');
          }
        },
        guardarTareas() {
          localStorage.setItem('tareas', JSON.stringify(this.tareas));
          this.registrarEvento('Actualizar Tarea');
        }
      },

      computed: {
        tareasPendientes() {
          return this.tareas.filter(tarea => !tarea.completa).length;
        },
        totalTareas() {
          return this.tareas.length;
        }
      },

      created() {
        this.listaeventos = [...eventosTemporales];
        this.registrarEvento('created');
      },
      beforeMount() {
        this.registrarEvento('beforeMount');
      },
      mounted() {
        this.registrarEvento('mounted');
      },
      beforeUpdate() {
        this.registrarEvento('beforeUpdate'); //para que la lista de eventos no sea tan larga había comentado este evento.
      },
      updated() {
        this.registrarEvento('updated'); //y este también. para que no se generé un bucle infinito al actualizar el DOM.
       },
      beforeUnmount() {
        this.registrarEvento('beforeUnmount');
      },
      unmounted() {
        this.registrarEvento('unmounted');
      }
    }).mount('#app');
  </script>
</body>
</html>
